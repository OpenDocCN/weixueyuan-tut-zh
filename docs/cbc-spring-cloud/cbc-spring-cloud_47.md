# Apollo（分布式配置中心）核心概念及核心功能介绍

> 原文：[`c.biancheng.net/view/5466.html`](http://c.biancheng.net/view/5466.html)

Apollo（阿波罗）是携程框架部门研发的分布式配置中心，能够集中化管理应用不同环境、不同集群的配置，配置修改后能够实时推送到应用端，并且具备规范的权限、流程治理等特性，适用于微服务配置管理场景。

服务端基于 Spring Boot 和 Spring Cloud 开发，打包后可以直接运行，不需要额外安装 Tomcat 等应用容器。

Java 客户端不依赖任何框架，能够运行于所有 Java 运行时环境，同时对 Spring/Spring Boot 环境也有较好的支持。

## Apollo 的核心功能点

#### 1\. 统一管理不同环境、不同集群的配置

Apollo 提供了一个统一界面，集中式管理不同环境（environment）、不同集群（cluster）、不同命名空间（namespace）的配置。

同一份代码部署在不同的集群，可以有不同的配置，比如 zk 的地址等。通过命名空间（namespace）可以很方便地支持多个不同应用共享同一份配置，同时还允许应用对共享的配置进行覆盖。

#### 2\. 配置修改实时生效（热发布）

用户在 Apollo 修改完配置并发布后，客户端能实时（1s）接收到最新的配置，并通知到应用程序。

#### 3\. 版本发布管理

所有的配置发布都有版本概念，从而可以方便地支持配置的回滚。

#### 4\. 灰度发布

支持配置的灰度发布，比如点击发布后，只对部分应用实例生效，等观察一段时间，确定没问题后再推给所有应用实例。

#### 5\. 权限管理、发布审核、操作审计

应用和配置的管理都有完善的权限管理机制，对配置的管理还分为编辑和发布两个环节，从而减少人为的错误。

所有的操作都有审计日志，方便追踪问题。

#### 6\. 客户端配置信息监控

可以方便地看到配置被哪些实例使用。

#### 7\. 提供 Java 和 .Net 原生客户端

提供了 Java 和 .Net 的原生客户端，方便应用集成。支持 Spring Placeholder、Annotation 和 Spring Boot 的 ConfigurationProperties，方便应用使用（需要 Spring 3.1.1+）。

同时提供了 Http 接口，非 Java 和 .Net 应用也可以方便地使用。

#### 8\. 提供开放平台 API

Apollo 自身提供了比较完善的统一配置管理界面，支持多环境、多数据中心配置管理、权限、流程治理等特性。不过 Apollo 出于通用性考虑，对配置的修改不会做过多限制，只要符合基本的格式就能够保存。

在我们的调研中发现，对于有些使用方，它们的配置可能会有比较复杂的格式，如 xml、json，需要对格式做校验。还有一些使用方如 DAL，不仅有特定的格式，而且针对输入的值也需要进行校验后方可保存，如检查数据库、用户名和密码是否匹配。

对于这类应用，Apollo 支持应用方通过开放接口在 Apollo 进行配置的修改和发布，并且具备完善的授权和权限控制。

#### 9\. 部署简单

配置中心作为基础服务，对可用性要求非常高，这就需要 Apollo 对外部依赖尽可能地少。

目前唯一的外部依赖是 MySQL，所以部署非常简单，只要安装好 Java 和 MySQL 就可以让 Apollo 跑起来。

Apollo 还提供了打包脚本，一键就可以生成所有需要的安装包，并且支持自定义运行时的参数。

## Apollo 核心概念

#### 1\. 应用

应用就是我们的项目，Apollo 客户端在运行时需要知道应用的标识，从而可以根据这个标识去配置中心获取对应的配置。应用的标识用 APPid 来指定，指定 APPid 的方式有多种，Spring Boot 项目中建议直接配置在 application.properties 中，跟着项目走。

#### 2\. 环境

环境就是常见的开发、测试、生产等，不同的环境对应的配置内容不一样。Apollo 客户端在运行时除了需要知道项目当前的身份标识，还需要知道当前项目对应的环境，从而可以根据环境去配置中心获取对应的配置。

指定项目当前环境的方式有多种，可以通过 Java System Property 或者配置文件来指定。

目前支持的环境有 Local（本地环境，加载本地配置）、DEV（开发环境）、FAT（测试环境）、UAT（集成环境）、PRO（生产环境）。

#### 3\. 集群

在多机房的环境下，针对不同的机房，我们可以划分出不同的集群，集群可以拥有不同的配置。指定项目对应集群的方式有多种，可以通过 Java System Property 或者配置文件来指定。

#### 4\. 命名空间

命名空间可以用来对配置做分类，不同类型的配置存放在不同的命名空间中，如数据库配置文件、消息队列配置、业务相关的配置等。命名空间还有一个公共的特性，那就是让多个项目共用同一份配置，比如 Redis 集群配置。

#### 5\. 权限控制

通过权限控制可以防止配置被不相干的人误操作。对于开发人员，可以只分配测试环境的修改权限和发布权限，只有负责人才能有正式环境的权限。