# MFC 文档、视图和框架窗口间的关系和消息传送

在上一节中对文档、视图和框架窗口做了简单地介绍，总结一下：文档相当于数据容器，视相当于查看数据的窗口或是和数据发生交互的窗口。（这一结构在 MFC 中的 OLE，ODBC 开发时又得到更多的拓展）因此一个完整的应用一般由四个类组成：CWinApp 应用类，CFrameWnd 窗口框架类，CDocument 文档类，CView 视类。

在程序运行时 CWinApp 将创建一个 CFrameWnd 框架窗口实例，而框架窗口将创建文档模板，然后有文档模板创建文档实例和视实例，并将两者关联。一般来讲我们只需对文档和视进行操作，框架的各种行为已经被 MFC 封装好了，不需人为干预，这也是 Microsoft 设计文档-视结构的主旨，使界面和逻辑分离，让开发人员将主要的精力放在程序的算法和功能实现上。

在应用中一个视对应一个文档，但一个文档可以包含多个视。一个应用中只用一个框架窗口，对多文档界面来讲可能有多个 MDI 子窗口。每一个视都是一个子窗口，在单文档界面中父窗口即是框架窗口，在多文档界面中父窗口为 MDI 子窗口。一个多文档应用中可以包含多个文档模板，一个模板定义了一个文档和一个或多个视之间的对应关系。同一个文档可以属于多个模板，但一个模板中只允许定义一个文档。同样一个视也可以属于多个文档模板。

接下来看看如何在程序中得到各种对象的指针：

*   全局函数 AfxGetApp 可以得到 CWinApp 应用类指针。
*   AfxGetApp()->m_pMainWnd 为框架窗口指针。
*   在框架窗口中：CFrameWnd::GetActiveDocument 得到当前活动文档指针。
*   在框架窗口中：CFrameWnd::GetActiveView 得到当前活动视指针。
*   在视中：CView::GetDocument 得到对应的文档指针。
*   在文档中：CDocument::GetFirstViewPosition，CDocument::GetNextView 用来遍历所有和文档关联的视。
*   在文档中：CDocument::GetDocTemplate 得到文档模板指针。
*   在多文档界面中：CMDIFrameWnd::MDIGetActive 得到当前活动的 MDI 子窗口。

一般来讲用户输入消息（如菜单选择，鼠标，键盘等）会首先发送视，如果视未处理则会发往框架窗口。所以定义消息映射时定义在视中就可以了，如果一个应用同时拥有多个视而当前活动视没有对消息进行处理则消息会发往框架窗口。