# DS1302 寄存器介绍

DS1302 的一条指令一个字节共 8 位，其中第 7 位（即最高位）固定为 1，这一位如果是 0 的话，那写进去也是无效的。第 6 位是选择 RAM 还是 CLOCK 的，我前边说过，我们这里主要讲 CLOCK 时钟的使用，它的 RAM 功能我们不用，所以如果选择 CLOCK 功能，第 6 位是 0，如果要用 RAM，那第 6 位就是 1。从第 5 到第 1 位，决定了寄存器的 5 位地址，而第 0 位是读写位，如果要写，这一位就是 0，如果要读，这一位就是 1。指令字节直观位分配如图 15-9 所示。![图 15-9  DS1302 命令字节](img/1e8cf25afb5b1aa38fdb2e9239a7124c.jpg)

图 15-9  DS1302 命令字节

DS1302 时钟的寄存器，其中 8 个和时钟有关的，5 位地址分别是 0b00000～0b00111，还有一个寄存器的地址是 01000，这是涓流充电所用的寄存器，我们这里不讲。在 DS1302 的数据手册里的地址，直接把第 7 位、第 6 位和第 0 位值给出来了，所以指令就成了 0x80、0x81 那些了，最低位是 1，那么表示读，最低位是 0 表示写，如图 15-10 所示。

![图 15-10  DS1302 的时钟寄存器](img/f810056e792ff0836f0fd121502cfc6e.jpg)

图 15-10  DS1302 的时钟寄存器

寄存器 0：最高位 CH 是一个时钟停止标志位。如果时钟电路有备用电源，上电后，我们要先检测一下这一位，如果这一位是 0，那说明时钟芯片在系统掉电后，由于备用电源的供给，时钟是持续正常运行的；如果这一位是 1，那么说明时钟芯片在系统掉电后，时钟部分不工作了。如果 Vcc1 悬空或者是电池没电了，当我们下次重新上电时，读取这一位，那这一位就是 1，我们可以通过这一位判断时钟在单片机系统掉电后是否还正常运行。剩下的 7 位高 3 位是秒的十位，低 4 位是秒的个位，这里再提请注意一次，DS1302 内部是 BCD 码，而秒的十位最大是 5，所以 3 个二进制位就够了。

寄存器 1：最高位未使用，剩下的 7 位中高 3 位是分钟的十位，低 4 位是分钟的个位。

寄存器 2：bit7 是 1 的话代表是 12 小时制，0 代表是 24 小时制；bit6 固定是 0，bit5 在 12 小时制下 0 代表的是上午，1 代表的是下午，在 24 小时制下和 bit4 一起代表了小时的十位，低 4 位代表的是小时的个位。

寄存器 3：高 2 位固定是 0，bit5 和 bit4 是日期的十位，低 4 位是日期的个位。

寄存器 4：高 3 位固定是 0，bit4 是月的十位，低 4 位是月的个位。

寄存器 5：高 5 位固定是 0，低 3 位代表了星期。

寄存器 6：高 4 位代表了年的十位，低 4 位代表了年的个位。请特别注意，这里的 00～99 指的是 2000 年～2099 年。

寄存器 7：最高位一个写保护位，如果这一位是 1，那么是禁止给任何其它寄存器或者那 31 个字节的 RAM 写数据的。因此在写数据之前，这一位必须先写成 0。