# Go 语言数据类型转换

Go 语言使用类型前置加括号的方式进行类型转换，一般格式如下：

T(表达式)

其中，T 代表要转换的类型。表达式包括变量、复杂算子和函数返回值等。

类型转换时，需要考虑两种类型的关系和范围，是否会发生数值截断等，参见下面代码：

```
package main

import (
        "fmt"
        "math"
)

func main() {

        // 输出各数值范围
        fmt.Println("int8 range:", math.MinInt8, math.MaxInt8)
        fmt.Println("int16 range:", math.MinInt16, math.MaxInt16)
        fmt.Println("int32 range:", math.MinInt32, math.MaxInt32)
        fmt.Println("int64 range:", math.MinInt64, math.MaxInt64)

        // 初始化一个 32 位整型值
        var a int32 = 1047483647
        // 输出变量的十六进制形式和十进制值
        fmt.Printf("int32: 0x%x %d\n", a, a)

        // 将 a 变量数值转换为十六进制, 发生数值截断
        b := int16(a)
        // 输出变量的十六进制形式和十进制值
        fmt.Printf("int16: 0x%x %d\n", b, b)

        // 将常量保存为 float32 类型
        var c float32 = math.Pi
        // 转换为 int 类型, 浮点发生精度丢失
        fmt.Println(int(c))
}
```

代码说明如下：

*   第 11～14 行，输出常见整型类型的数值范围。
*   第 17 行，声明 int32 类型的 a 变量并初始化。
*   第 19 行，使用 fmt.Printf 的`%x`动词将数值以十六进制格式输出。这一行输出 a 在转换前的 32 位的值。
*   第 22 行，将 a 的值转换为 int16 类型，也就是从 32 位有符号整型转换为 16 位有符号整型。由于 16 位变量没有 32 位变量的数值范围大，因此数值会进行截断。
*   第 24 行，输出转换后的 a 变量值，也就是 b 的值。同样以十六进制和十进制两种方式进行打印。
*   第 27 行，math.Pi 是 math 包的常量，默认没有类型，会在引用到的地方自动根据实际类型进行推导。这里 math.Pi 被存到 c 中，类型为 float32。
*   第 29 行，将 float32 转换为 int 类型并输出。

代码输出如下：

int8 range: -128 127
int16 range: -32768 32767
int32 range: -2147483648 2147483647
int64 range: -9223372036854775808 9223372036854775807
int32: 0x3e6f54ff 1047483647
int16: 0x54ff 21759
3

根据输出结果，16 位有符号整型的范围是 -32768～32767，而 a 变量的 1047483647 不在这个范围内。1047483647 对应的十六进制为 0x3e6f54ff，转为 16 位变量后，长度缩短一半，也就是在十六进制上砍掉一半，变成 0x54ff，对应的十进制值为 21759。

浮点数在转换为整型时，会将小数部分去掉，只保留整数部分。

整型截断在类型转换中发生的较为隐性，有些即为难追查的问题，很小一部分是由整型截断造成。