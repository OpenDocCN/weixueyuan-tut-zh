# Go 语言初始化结构体的成员变量

结构体在实例化时可以直接对成员变量进行初始化。初始化有两种形式：一种是字段“键值对”形式及多个值的列表形式。键值对形式的初始化适合选择性填充字段较多的结构体；多个值的列表形式适合填充字段较少的结构体。

## 使用“键值对”初始化结构体

结构体可以使用“键值对”（Key value pair）初始化字段，每个“键”（Key）对应结构体中的一个字段。键的“值”（Value）对应字段需要初始化的值。

键值对的填充是可选的，不需要初始化的字段可以不填入初始化列表中。

结构体实例化后字段的默认值是字段类型的默认值，例如：数值为 0，字符串为空字符串，布尔为 false，指针为 nil 等。

#### 1) 键值对初始化结构体的书写格式

键值对初始化的格式如下：

ins := 结构体类型名{
    字段 1: 字段 1 的值,
    字段 2: 字段 2 的值,
    …
}

下面是对各个部分的说明：

*   结构体类型：定义结构体时的类型名称。
*   字段 1、字段 2：结构体的成员字段名。结构体类型名的字段初始化列表中，字段名只能出现一次。
*   字段 1 的值、字段 2 的值：结构体成员字段的初始值。

键值之间以`:`分隔；键值对之间以`,`分隔。

#### 2) 使用键值对填充结构体的例子

下面例子中描述了家里的人物关联。正如儿歌里唱的：“爸爸的爸爸是爷爷”，人物之间可以使用多级的 child 来描述和建立关联。使用键值对形式填充结构体的代码如下：

```
type People struct {
    name  string
    child *People
}

relation := &People{
    name: "爷爷",
    child: &People{
        name: "爸爸",
        child: &People{
                name: "我",
        },
    },
}
```

代码说明如下：

*   第 1 行，定义 People 结构体。
*   第 2 行，结构体的字符串字段。
*   第 3 行，结构体的结构体指针字段，类型是 *People。
*   第 6 行，relation 由 People 类型取地址后，形成类型为 *People 的实例。
*   第 8 行，child 在初始化时，需要 *People 类型的值。使用取地址初始化一个 People。

结构体成员中只能包含结构体的指针类型，包含非指针类型会引起编译错误。

## 使用多个值的列表初始化结构体

Go 语言可以在“键值对”初始化的基础上忽略“键”。也就是说，可以使用多个值的列表初始化结构体的字段。

#### 1) 多个值列表初始化结构体的书写格式

多个值使用逗号分隔初始化结构体，例如：

ins := 结构体类型名{
    字段 1 的值,
    字段 2 的值,
    …
}

使用这种格式初始化时，需要注意：

*   必须初始化结构体的所有字段。
*   每一个初始值的填充顺序必须与字段在结构体中的声明顺序一致。
*   键值对与值列表的初始化形式不能混用。

#### 2) 多个值列表初始化结构体的例子

下面的例子描述了一段地址结构。地址要求具有一定的顺序。例如：

```
type Address struct {
    Province    string
    City        string
    ZipCode     int
    PhoneNumber string
}

addr := Address{
    "四川",
    "成都",
    610000,
    "0",
}

fmt.Println(addr)
```

运行代码，输出如下：
{四川 成都 610000 0}

## 初始化匿名结构体

匿名结构体没有类型名称，无须通过 type 关键字定义就可以直接使用。

#### 1) 匿名结构体定义格式和初始化写法

匿名结构体的初始化写法由结构体定义和键值对初始化两部分组成。结构体定义时没有结构体类型名，只有字段和类型定义。键值对初始化部分由可选的多个键值对组成，如下格式所示：

ins := struct {
    // 匿名结构体字段定义
    字段 1 字段类型 1
    字段 2 字段类型 2
    …
}{
    // 字段值初始化
    初始化字段 1: 字段 1 的值,
    初始化字段 2: 字段 2 的值,
    …
}

下面是对各个部分的说明：

*   字段 1、字段 2……：结构体定义的字段名。
*   初始化字段 1、初始化字段 2……：结构体初始化时的字段名，可选择性地对字段初始化。
*   字段类型 1、字段类型 2……：结构体定义字段的类型。
*   字段 1 的值、字段 2 的值……：结构体初始化字段的初始值。

键值对初始化部分是可选的，不初始化成员时，匿名结构体的格式变为：

ins := struct {
    字段 1 字段类型 1
    字段 2 字段类型 2
    …
}

#### 2) 使用匿名结构体的例子

在本例中，使用匿名结构体的方式定义和初始化一个消息结构，这个消息结构具有消息标示部分（ID）和数据部分（data）。打印消息内容的 printMsg() 函数在接收匿名结构体时需要在参数上重新定义匿名结构体，代码如下：

```
package main

import (
    "fmt"
)

// 打印消息类型, 传入匿名结构体
func printMsgType(msg *struct {
    id   int
    data string
}) {

    // 使用动词%T 打印 msg 的类型
    fmt.Printf("%T\n", msg)
}

func main() {

    // 实例化一个匿名结构体
    msg := &struct {  // 定义部分
        id   int
        data string
    }{  // 值初始化部分
        1024,
        "hello",
    }

    printMsgType(msg)
}
```

代码输出如下：
*struct { id int; data string }

代码说明如下：

*   第 8 行，定义 printMsgType() 函数，参数为 msg，类型为 *struct{id int data string}。因为类型没有使用 type 定义，所以需要在用到的地方每次进行定义。
*   第 14 行，使用字符串格式化中的`%T`动词，将 msg 的类型名打印出来。
*   第 20 行，对匿名结构体进行实例化，同时初始化成员。
*   第 21 和 22 行，定义匿名结构体的字段。
*   第 24 和 25 行，给匿名结构体字段赋予初始值。
*   第 28 行，将 msg 传入 printMsgType() 函数中进行函数调用。

匿名结构体的类型名是结构体包含字段成员的详细描述。匿名结构体在使用时需要重新定义，造成大量重复的代码，因此开发中较少使用。