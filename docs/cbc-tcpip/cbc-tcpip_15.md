# IP 协议的工作方式

> 原文：[`c.biancheng.net/view/6386.html`](http://c.biancheng.net/view/6386.html)

IP 协议提供了一种分层的、与硬件无关的寻址系统，它可以在复杂的路由式网络中传递数据所需的服务。

IP 协议可以将多个交换网络连接起来，在源地址和目的地址之间传送数据包。同时，它还提供数据重新组装功能，以适应不同网络对数据包大小的要求。

在一个路由式网络中，源地址主机向目标地址主机发送数据时，IP 协议是如何将数据成功发送到目标主机上的呢？

由于网络分同网段和不同网段两种情况，工作方式如下：

#### 同网段

如果源地址主机和目标地址主机在同一网段，目标 IP 地址被 ARP 协议解析为 MAC 地址，然后根据 MAC 地址，源主机直接把数据包发给目标主机。

#### 不同网段

如果源地址主机和目标地址主机在不同网段，数据包发送过程如下：

1.  网关（一般为路由器）的 IP 地址被 ARP 协议解析为 MAC 地址。根据该 MAC 地址，源主机将数据包发送到网关。
2.  网关根据数据包中的网段 ID 寻找目标网络。如果找到，将数据包发送到目标网段；如果没找到，重复步骤（1）将数据包发送到上一级网关。
3.  数据包经过网关被发送到正确的网段中。目标 IP 地址被 ARP 协议解析为 MAC 地址。根据该 MAC 地址，数据包被发送给目标地址的主机。